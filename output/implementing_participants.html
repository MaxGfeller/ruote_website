<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <title>ruote - implementing participants</title>
    <script src='/js/shCore.js'></script>
    <script src='/js/shBrushRuby.js'></script>
    <script src='/js/shBrushJScript.js'></script>
    <script src='/js/shBrushXml.js'></script>
    <link href='/css/reset.css' rel='stylesheet' type='text/css' />
    <link href='/css/shCore.css' rel='stylesheet' type='text/css' />
    <link href='/css/shThemeDefault.css' rel='stylesheet' type='text/css' />
    <link href='/css/ruote.css' rel='stylesheet' type='text/css' />
  </head><body>
    <div id='container'>
      <div id='header'>
        <div id='header-top'>
          <div id='header-left'>
            <a href='/'>
              <img src='/images/ruote.png' />
            </a>
            <div id='header-subtitle'>
              open source ruby workflow engine
            </div>
          </div>
          <div id='header-right'>
          </div>
        </div>
        <div id='nav'>
          <span>
            <a href='documentation.html' title='documentation'>doc</a>
            <a href='source.html' title='source code'>source</a>
            <a href='download.html' title='download'>download</a>
            <a href='lists.html' title='mailing lists and irc'>lists</a>
            <a href='http://jmettraux.wordpress.com' title='blog'>blog</a>
            <a href='map.html' title='map'>map</a>
            <a class='nihongo' href='ja.html' title='日本語'>日本語</a>
          </span>
        </div>
      </div>
      <div id='content'>
        <h2>implementing participants</h2>
        <p>Participant receive workitems, do something about/to them. Then, if necessary, they reply to ruote with the [updated] workitem.</p>
        <p>Sometimes, while a participant is holding / consuming a workitem, it might receive a &#8220;cancel&#8221; order from ruote, telling it to discard the corresponding workitem (and not to reply).</p>
        <h3 id="stateless">stateless participants</h3>
        <p>Perhaps state{less|full} is a poor wording. It should be OK for now (suggestions on the <a href="http://groups.google.com/group/openwferu-users">mailing list</a> are welcome).</p>
        <p><strong>Stateless participants are the preferred approach</strong>. They can be used by any worker, while stateful participants can only be used by the worker in the Ruby runtime where they got instantiated.</p>
        <p>Stateless participants are instantiated for each workitem dispatch by the worker.</p>
        <pre class="brush: ruby">
        class WakeUpParticipant
          include Ruote::LocalParticipant
          def initialize (opts)
            @opts = opts
          end
          def consume (workitem)
            City::Notifications.wake_up(:mayor, @opts['city'], workitem.fields['message'])
            reply_to_engine(workitem)
          end
          def cancel (fei, flavour)
            # no need for an implementation, since consume replies immediately,
            # never 'holding' a workitem
          end
        end
        
        engine.register_participant 'beijing', WakeUpParticipant, 'city' =&gt; 'Beijing'
        </pre>
        <p>In this example. The WakeUpParticipant wraps an City::Notifications service call. The participant is instantiated each time, with the options passed in the implicit hash (last parameter of the register_participant method).</p>
        <h3 id="stateful">stateful participants</h3>
        <p>Stateful participants are instantiated at registration time. They thus work/exist only in the Ruby runtime that saw their instantiation.</p>
        <p><span class="caps">TODO</span></p>
        <h3 id="block">block participants</h3>
        <p>Block participants are stateful participants. They are easy to understand and are very practical, in simple settings (1 worker, 1 engine), they are OK.</p>
        <p><span class="caps">TODO</span></p>
        <h3 id="threads">participants and threads</h3>
        <p><span class="caps">TODO</span></p>
      </div>
    </div>
    <div id='footer'>
      <p>
        <span id='footer-left'>
          this website was created with
          <a href='http://nanoc.stoneship.org'>nanoc</a>
          and
          <a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
        </span>
        <span id='footer-right'>
          &copy; 2005-2010 the ruote team
        </span>
      </p>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        SyntaxHighlighter.all();
      //]]>
    </script>
    <script src='http://www.google-analytics.com/ga.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        if (location.hostname != 'localhost' && location.hostname != '127.0.0.1') {
          var pageTracker=_gat._getTracker('UA-138748-2');
          pageTracker._initData();
          pageTracker._trackPageview();
        }
      //]]>
    </script>
  </body>
</html>
