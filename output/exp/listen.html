<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <title>ruote - listen expression</title>
    <script src='/js/shCore.js'></script>
    <script src='/js/shBrushRuby.js'></script>
    <script src='/js/shBrushJScript.js'></script>
    <script src='/js/shBrushXml.js'></script>
    <link href='/css/reset.css' rel='stylesheet' type='text/css' />
    <link href='/css/shCore.css' rel='stylesheet' type='text/css' />
    <link href='/css/shThemeDefault.css' rel='stylesheet' type='text/css' />
    <link href='/css/ruote.css' rel='stylesheet' type='text/css' />
  </head><body>
    <div id='container'>
      <div id='header'>
        <div id='header-top'>
          <div id='header-left'>
            <a href='/'>
              <img src='/images/ruote.png' />
            </a>
            <div id='header-subtitle'>
              open source ruby workflow engine
            </div>
          </div>
          <div id='header-right'>
          </div>
        </div>
        <div id='nav'>
          <span>
            <a href='documentation.html' title='documentation'>doc</a>
            <a href='source.html' title='source code'>source</a>
            <a href='download.html' title='download'>download</a>
            <a href='lists.html' title='mailing lists and irc'>lists</a>
            <a href='http://jmettraux.wordpress.com' title='blog'>blog</a>
            <a href='map.html' title='map'>map</a>
            <a class='nihongo' href='ja.html' title='日本語'>日本語</a>
          </span>
        </div>
      </div>
      <div id='content'>
        <h2>listen</h2>
        <p>Listens for activity (incoming or outgoing workitems) on a (set of)<br />
        participant(s).</p>
        <p>This expression is an advanced one. It allows for cross process instance<br />
        communication or at least cross branch communication within the same<br />
        process instance.</p>
        <p>DO <span class="caps">NOT</span> confuse the listen expression with the &#8216;listener&#8217; concept. They are<br />
        not directly related. The listen expression listens to workitem activity<br />
        inside of the engine, while a listener listens for workitems or launchitems<br />
        from sources external to the ruote workflow engine.</p>
        <p>It can be used in two ways : &#8216;blocking&#8217; or &#8216;triggering&#8217;. In both cases<br />
        the listen expression &#8216;reacts&#8217; upon activity (incoming or outgoing workitem)<br />
        happening on a channel (a participant name).</p>
        <h3>blocking</h3>
        <p>A blocking example :</p>
        <pre class="brush: ruby">
          sequence do
            participant 'alice'
            listen :to =&gt; 'bob'
            participant 'charly'
          end
        </pre>
        <p>Once the listen expression got applied, this process will block until a<br />
        workitem (in any other process instance in the same engine) is dispatched<br />
        to participant &#8216;bob&#8217;. It then proceeds to charly.</p>
        <h3>triggering</h3>
        <p>This way of using &#8216;listen&#8217; is useful for launching processes that &#8220;stalk&#8221;<br />
        other processes :</p>
        <pre class="brush: ruby">
          Ruote.process_definition :name =&gt; 'stalker' do
            listen :to =&gt; 'bob' do
              participant :ref =&gt; 'charly'
            end
          end
        </pre>
        <p>This small process will never exits and will send a workitem to charly<br />
        each time the ruote engine sends a workitem to bob.</p>
        <p>The workitems passed to charly will be copies of the workitem initially<br />
        applied to the &#8216;listen&#8217; expression, but with a copy of the fields of the<br />
        workitem passed to bob, merged in.</p>
        <p>Note : for now, the triggered segments of processes are &#8216;forgotten&#8217;. The<br />
        &#8216;listen&#8217; expression doesn&#8217;t keep track of them. This also means that in<br />
        case of cancel, the triggered segments will not get cancelled.</p>
        <h3>:merge</h3>
        <p>By default, :merge is set to true, the listened for workitems see their<br />
        values merged into a copy of the workitem held in the listen expression<br />
        and this copy is delivered to the expressions that are client to the<br />
        &#8216;listen&#8217;.</p>
        <h3>:upon</h3>
        <p>There are two kinds of main events in ruote, apply and reply. Thus,<br />
        a listen expression may listen to &#8216;apply&#8217; and to &#8216;reply&#8217; and this is<br />
        defined by the :upon attribute.</p>
        <p>By default, listens upon &#8216;apply&#8217; (engine handing workitem to participant).</p>
        <p>Can be set to &#8216;reply&#8217;, to react on workitems being handed back to the<br />
        engine by the participant.</p>
        <h3>:to and :on</h3>
        <p>The :to attribute has already been seen, it can be replaced by the :on one.</p>
        <p>Those two attributes are expected to hold regular expressions, so it&#8217;s OK to<br />
        write things like :</p>
        <pre class="brush: ruby">
          listen :to =&gt; "^user\_.+"
        </pre>
        <p>or</p>
        <pre class="brush: ruby">
          listen :to =&gt; /^user\_.+/
        </pre>
        <p>To listen for workitems for all the participant whose name start with<br />
        &#8220;user_&#8221;.</p>
        <h3>:wfid</h3>
        <p>By default, a listen expression listens for any workitem/participant event<br />
        in the engine. Setting the :wfid attribute to &#8216;true&#8217; or &#8216;same&#8217; or &#8216;current&#8217;<br />
        will make the listen expression only care for events belonging to the<br />
        same process instance (same wfid).</p>
      </div>
    </div>
    <div id='footer'>
      <p>
        <span id='footer-left'>
          this website was created with
          <a href='http://nanoc.stoneship.org'>nanoc</a>
          and
          <a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
        </span>
        <span id='footer-right'>
          &copy; 2005-2010 the ruote team
        </span>
      </p>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        SyntaxHighlighter.all();
      //]]>
    </script>
    <script src='http://www.google-analytics.com/ga.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        if (location.hostname != 'localhost' && location.hostname != '127.0.0.1') {
          var pageTracker=_gat._getTracker('UA-138748-2');
          pageTracker._initData();
          pageTracker._trackPageview();
        }
      //]]>
    </script>
  </body>
</html>
