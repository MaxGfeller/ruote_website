<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <title>ruote - apply expression</title>
    <script src='/js/shCore.js'></script>
    <script src='/js/shBrushRuby.js'></script>
    <script src='/js/shBrushJScript.js'></script>
    <script src='/js/shBrushXml.js'></script>
    <link href='/css/reset.css' rel='stylesheet' type='text/css' />
    <link href='/css/shCore.css' rel='stylesheet' type='text/css' />
    <link href='/css/shThemeDefault.css' rel='stylesheet' type='text/css' />
    <link href='/css/ruote.css' rel='stylesheet' type='text/css' />
  </head><body>
    <div id='container'>
      <div id='header'>
        <div id='header-top'>
          <div id='header-left'>
            <a href='/'>
              <img src='/images/ruote.png' />
            </a>
            <div id='header-subtitle'>
              open source ruby workflow engine
            </div>
          </div>
          <div id='header-right'>
          </div>
        </div>
        <div id='nav'>
          <span>
            <a href='documentation.html' title='documentation'>doc</a>
            <a href='source.html' title='source code'>source</a>
            <a href='download.html' title='download'>download</a>
            <a href='lists.html' title='mailing lists and irc'>lists</a>
            <a href='http://jmettraux.wordpress.com' title='blog'>blog</a>
            <a href='map.html' title='map'>map</a>
            <a class='nihongo' href='ja.html' title='日本語'>日本語</a>
          </span>
        </div>
      </div>
      <div id='content'>
        <h2>apply</h2>
        <p>The &#8216;apply&#8217; expression is an advanced expression.</p>
        <p>It takes as input an <span class="caps">AST</span> and applies it. The <span class="caps">AST</span> may be placed in a field<br />
        or a variable or passed directly to the apply.</p>
        <p>These apply examples :</p>
        <pre class="brush: ruby">
          apply :tree =&gt; [ 'echo', { 'nada' =&gt; nil }, [] ]
        
          sequence do
            set :var =&gt; 'tree', :val =&gt; [ 'echo', { 'nada' =&gt; nil }, [] ]
            apply # looks by default in variable 'tree'
          end
        
          sequence do
            set :var =&gt; 't', :val =&gt; [ 'echo', { 'nada' =&gt; nil }, [] ]
            apply :tree_var =&gt; 't'
          end
        
          sequence do
            set :field =&gt; 't', :val =&gt; [ 'echo', { 'nada' =&gt; nil }, [] ]
            apply :tree_field =&gt; 't'
          end
        </pre>
        <p>All are equivalent to</p>
        <pre class="brush: ruby">
          echo 'nada'
        
        </pre>
        <h3>apply and subprocesses</h3>
        <p>There is an interesting way of using &#8216;apply&#8217;, it&#8217;s close to the way of<br />
        the Ruby &#8220;yield&#8221; expression.</p>
        <pre class="brush: ruby">
          pdef = Ruote.process_definition 'test' do
            sequence do
              handle do
                participant 'alpha'
              end
              handle do
                participant 'bravo'
              end
            end
            define 'handle' do
              sequence do
                participant 'prepare_data'
                apply
                participant 'rearrange_data'
              end
            end
          end
        </pre>
        <p>With this process definition, the particpant alpha and bravo are handed<br />
        a workitem in sequence, but each time, the data gets prepared and<br />
        re-arranged.</p>
        <p>&#8216;apply&#8217; simply picks the value of the tree to apply in the local variable<br />
        &#8216;tree&#8217;.</p>
        <p>Passing variables to applied trees is possible :</p>
        <pre class="brush: ruby">
          pdef = Ruote.process_definition do
            handle do
              participant '${v:target}', :message =&gt; 'x'
            end
            define 'handle' do
              sequence do
                participant 'prepare_data'
                apply :v =&gt; 'alpha'
                apply :v =&gt; 'bravo'
                participant 'rearrange_data'
              end
            end
          end
        
        </pre>
        <h3>on_error</h3>
        <p>It&#8217;s OK, to place an on_error on the apply</p>
        <pre class="brush: ruby">
          pdef = Ruote.process_definition do
            handle do
              sequence do
                echo 'in'
                nemo
              end
            end
            define 'handle' do
              apply :on_error =&gt; 'notify' # &lt;==
              echo 'over.'
            end
            define 'notify' do
              echo 'error'
            end
          end
        </pre>
      </div>
    </div>
    <div id='footer'>
      <p>
        <span id='footer-left'>
          this website was created with
          <a href='http://nanoc.stoneship.org'>nanoc</a>
          and
          <a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
        </span>
        <span id='footer-right'>
          &copy; 2005-2010 the ruote team
        </span>
      </p>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        SyntaxHighlighter.all();
      //]]>
    </script>
    <script src='http://www.google-analytics.com/ga.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        if (location.hostname != 'localhost' && location.hostname != '127.0.0.1') {
          var pageTracker=_gat._getTracker('UA-138748-2');
          pageTracker._initData();
          pageTracker._trackPageview();
        }
      //]]>
    </script>
  </body>
</html>
