<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <title>ruote - iterator expression</title>
    <script src='/js/shCore.js'></script>
    <script src='/js/shBrushRuby.js'></script>
    <script src='/js/shBrushJScript.js'></script>
    <script src='/js/shBrushXml.js'></script>
    <link href='/css/reset.css' rel='stylesheet' type='text/css' />
    <link href='/css/shCore.css' rel='stylesheet' type='text/css' />
    <link href='/css/shThemeDefault.css' rel='stylesheet' type='text/css' />
    <link href='/css/ruote.css' rel='stylesheet' type='text/css' />
  </head><body>
    <div id='container'>
      <div id='header'>
        <div id='header-top'>
          <div id='header-left'>
            <a href='/'>
              <img align='left' src='/images/ruote.png' />
              <span id='ruote' onclick="location.href = '/'; return true;">
                ruote 2.1
              </span>
            </a>
          </div>
          <div id='header-right'>
          </div>
        </div>
        <div id='header-bottom'>
          <div id='header-subtitle'>
            open source ruby workflow engine
          </div>
          <div id='header-menu'>
            <a href='documentation.html' title='documentation'>doc</a>
            <a href='source.html' title='source code'>source</a>
            <a href='download.html' title='download'>download</a>
            <a href='lists.html' title='mailing lists and irc'>lists</a>
            <a href='http://jmettraux.wordpress.com' title='blog'>blog</a>
            <a href='map.html' title='map'>map</a>
            <a class='nihongo' href='ja.html' title='日本語'>日本語</a>
          </div>
        </div>
      </div>
      <div id='content'>
        <h2>iterator</h2>
        <p>Iterating on a list of values</p>
        <pre class="brush: ruby">
          pdef = Ruote.process_definition :name =&gt; 'test' do
            iterator :on_val =&gt; 'alice, bob, charly', :to_var =&gt; 'v' do
              participant '${v:v}'
            end
          end
        </pre>
        <p>This expression expects at list an &#8216;on&#8217; attribute, which can be :on,<br />
        :on_val, :on_value for a value (usually a comma separated list), :on_v,<br />
        :on_var, :on_variable for a list contained in the designated variable and<br />
        :on_f, :on_fld, :on_field for a list contained in the designated workitem<br />
        field.</p>
        <p>The &#8216;on&#8217; attribute is used to instruct the expression on which list/array<br />
        it should iterate.</p>
        <p>The &#8216;to&#8217; attribute takes two forms, :to_v, :to_var, :to_variable or<br />
        :to_f, :to_fld, :to_field.</p>
        <p>The &#8216;to&#8217; attribute instructs the iterator into which variable or field<br />
        it should place the current value (the value being iterated over).</p>
        <p>If there is no &#8216;to&#8217; specified, the current value is placed in the variable<br />
        named &#8216;i&#8217;.</p>
        <p>The variables &#8216;ii&#8217; contains the index (from 0 to &#8230;) of the current value<br />
        (think Ruby&#8217;s #each_with_index).</p>
        <p>The &#8216;on&#8217; attribute can be replaced by a :time or a :branches attribute.</p>
        <pre class="brush: ruby">
          pdef = Ruote.process_definition :name =&gt; 'test' do
            iterator :times =&gt; '3'
              participant 'accounting'
            end
          end
        </pre>
        <p>will be equivalent to</p>
        <pre class="brush: ruby">
          pdef = Ruote.process_definition :name =&gt; 'test' do
            sequence do
              participant 'accounting'
              participant 'accounting'
              participant 'accounting'
            end
          end
        
        </pre>
        <h3>the classical case</h3>
        <p>Iterating over a workitem field :</p>
        <pre class="brush: ruby">
          pdef = Ruote.process_definition :name =&gt; 'test' do
            iterator :on_field =&gt; 'customers', :to_f =&gt; 'customer'
              participant '${f:customer}'
            end
          end
        
        </pre>
        <h3>break/rewind/continue/skip/jump</h3>
        <p>The &#8216;iterator&#8217; expression understands a certain the following commands :</p>
        <ul>
        	<li>break (_break) : exits the iteration</li>
        	<li>rewind : places the iteration back at the first iterated value</li>
        	<li>continue : same as &#8216;rewind&#8217;</li>
        	<li>skip : skips a certain number of steps (relative)</li>
        	<li>jump : jump to certain step (absolute)</li>
        </ul>
        <pre class="brush: ruby">
          pdef = Ruote.process_definition :name =&gt; 'test' do
            iterator :times =&gt; '3'
              sequence do
                participant 'accounting', :review =&gt; '${v:i}'
                rewind :if =&gt; '${f:redo_everything} == true'
              end
            end
          end
        </pre>
        <h3>iterator command in the workitem</h3>
        <p>It&#8217;s OK to issue a command to the iterator from a participant via the<br />
        workitem.</p>
        <pre class="brush: ruby">
          pdef = Ruote.process_definition do
            iterator :times =&gt; 10
              sequence do
                participant 'accounting'
                participant 'adjust'
              end
            end
          end
        </pre>
        <p>where</p>
        <pre class="brush: ruby">
          class Adjust
            include Ruote::LocalParticipant
            def consume (workitem)
              workitem.command = 'break' if workitem.fields['amount'] &gt; 10_000
              reply_to_engine(workitem)
            end
            def cancel (fei, flavour)
            end
          end
        </pre>
        <p>A completely stupid example&#8230; The adjust participant will make the<br />
        loop break if the amount reaches 10_000 (euros?).</p>
        <h3>break/rewind/continue/skip/jump with :ref</h3>
        <p>An iterator can be tagged (with the :tag attribute) and directly referenced<br />
        from a break/rewind/continue/skip/jump command.</p>
        <p>It&#8217;s very useful when iterators (and cursors/loops) are nested within each<br />
        other or when one has to act on an iterator from outside of it.</p>
        <pre class="brush: ruby">
          concurrence do
        
            iterator :on =&gt; 'alpha, bravo, charly', :tag =&gt; 'review' do
              participant '${v:i}'
            end
        
            # meanwhile ...
        
            sequence do
              participant 'main control program'
              _break :ref =&gt; 'review', :if =&gt; '${f:cancel_review} == yes'
            end
          end
        </pre>
        <p>in this example, the participant &#8216;main control program&#8217; may cancel the<br />
        review.</p>
        <pre class="brush: ruby">
          iterator :on =&gt; 'c1, c2, c3', :to_f =&gt; 'client', :tag =&gt; 'main' do
            cursor do
              participant :ref =&gt; '${f:client}'
              _break :ref =&gt; 'main', :if =&gt; '${f:cancel_everything}'
              participant :ref =&gt; 'salesclerk'
              participant :ref =&gt; 'salesclerk'
            end
          end
        </pre>
        <p>in this weird process, if one customer says &#8220;cancel everything&#8221; (set the<br />
        workitem field &#8220;cancel_everything&#8221; to true), then the whole iterator<br />
        gets &#8216;broken&#8217; out of.</p>
      </div>
      <div id='footer'>
        <div id='footer-left'>
          this website was created with
          <a href='http://nanoc.stoneship.org'>nanoc</a>
          and
          <a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
        </div>
        <div id='footer-right'>
          &copy; 2005-2010 the ruote team
        </div>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        SyntaxHighlighter.all();
      //]]>
    </script>
    <script src='http://www.google-analytics.com/ga.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        if (location.hostname != 'localhost' && location.hostname != '127.0.0.1') {
          var pageTracker=_gat._getTracker('UA-138748-2');
          pageTracker._initData();
          pageTracker._trackPageview();
        }
      //]]>
    </script>
  </body>
</html>
